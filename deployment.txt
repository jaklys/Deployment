import subprocess
from collections import defaultdict
import re

def test_dns_balancing(domains, num_requests=10):
    results = {}

    for domain in domains:
        ip_count = defaultdict(int)

        for _ in range(num_requests):
            try:
                # Spustíme nslookup pro zadaný domain
                result = subprocess.run(['nslookup', domain], capture_output=True, text=True)
                output = result.stdout
                
                # Získáme IP adresy z části "Non-authoritative answer"
                ips = re.findall(r'Name:\s+{}\nAddress:\s+(\S+)'.format(domain), output)

                for ip in ips:
                    ip_count[ip] += 1
                    
            except subprocess.SubprocessError as e:
                print(f'Při provádění nslookup došlo k chybě: {e}')
        
        # Uložíme výsledky pro danou doménu
        results[domain] = ip_count

    # Výpis výsledků pro všechny testované domény
    for domain, counts in results.items():
        print(f'Výsledky pro doménu {domain}:')
        for ip, count in counts.items():
            print(f'  IP adresa {ip} byla vrácena {count} krát z {num_requests} requestů.')
        print()  # Nový řádek pro lepší přehlednost

# Použití funkce
test_dns_balancing(['example.com', 'google.com'], num_requests=20)