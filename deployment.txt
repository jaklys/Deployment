SELECT 
    t.TRADEID,
    t.EQTQUOTEID,
    t.ISIN,
    t.NIXID,
    eq.PUBLICOFFER,
    t.TRADEDATE,
    t.STRIKEDATE,
    t.STARTDATE AS ISSUEDATE,
    t.STATUS,
    t.PRODUCT,
    t.NOTIONAL,
    t.BROKERPARTYID,
    t.SALESPERSON,
    t.TENOR,
    t.SETTLEMENT,
    t.MATURITYDATE,
    t.SETTLEMENTDATE,
    TRUNC(t.SUBMISSIONDATE) AS SUBMISSIONDATE
FROM 
    ewarrants_owner.tbl_custom_eq_price_request eq
JOIN 
    ewarrants_owner.tbl_custom_trade t ON eq.pricerequestid = t.pricerequestid
JOIN 
    ewarrants_owner.tbl_instrument i ON t.instrumentid = i.instrumentid
JOIN 
    ewarrants_owner.tbl_fx_rate_history x ON x.fxdate = TRUNC(t.strikedate)
WHERE 
    TRUNC(t.submissiondate) = TRUNC(SYSDATE - 1)
AND 
    t.counterpartyid NOT IN (41978402)
AND 
    (
        CAST((t.denomination / x.rate) AS INT) < 100000
        AND (CAST((t.MINTRADABLEAMOUNT / x.rate) AS INT) < 100000 OR t.MINTRADABLEAMOUNTFX IS NULL)
    )
AND 
    t.STATUS = eq.STATUS
AND 
    t.COUNTERPARTYID = eq.COUNTERPARTYID
AND 
    x.CCY1 = t.CCY1
AND 
    x.CCY2 = DECODE(t.currency, NULL, 'EUR', t.currency)
AND 
    t.userisexternal = 0
AND 
    t.tradingmedium NOT IN ('FSX')
AND 
    t.termssheettype IN ('GSSP_Enhanced', 'GSSP_SwissPP')
AND 
    t.eqtquoteid NOT LIKE 'JP%'