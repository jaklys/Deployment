import os

def add_profile_to_jil_files(directory_path, profile_value):
    # Projdi všechny soubory v dané cestě
    for root, dirs, files in os.walk(directory_path):
        for file in files:
            if file.endswith(".jil"):
                file_path = os.path.join(root, file)
                
                with open(file_path, 'r') as f:
                    content = f.readlines()
                
                # Zkontroluj, zda soubor již obsahuje parametr 'profile:'
                profile_exists = any("profile:" in line for line in content)
                
                # Pokud 'profile:' není v souboru, přidej ho
                if not profile_exists:
                    with open(file_path, 'a') as f:
                        f.write(f"\nprofile: {profile_value}\n")
                        print(f"Added profile to {file_path}")

# Cesta k adresáři se soubory .jil
directory_path = r'Z:\Your\Path\Here'
# Hodnota profilu, kterou chcete přidat
profile_value = r'D:\DATA\Groups\MktEnv\NodeRunner\config\AutoSys-EMEA-UAT1-A.config'

# Spuštění funkce
add_profile_to_jil_files(directory_path, profile_value)


import os
from pathlib import Path
import pytest

# Parametrizace testu, cesta je parametr
@pytest.mark.parametrize("jil_directory", [
    '../JILs/P13',  # Přidejte další cesty dle potřeby
])
def test_all_jil_files_have_profile(jil_directory):
    # Získání absolutní cesty k adresáři s .jil soubory
    directory_path = Path(jil_directory).resolve()
    missing_profile_files = []
    
    # Projdi všechny soubory v dané cestě
    for root, dirs, files in os.walk(directory_path):
        for file in files:
            if file.endswith(".jil"):
                file_path = os.path.join(root, file)
                
                with open(file_path, 'r') as f:
                    content = f.read()
                
                # Zkontroluj, zda soubor obsahuje parametr 'profile:'
                if "profile:" not in content:
                    missing_profile_files.append(file_path)

    # Pokud jsou soubory, kde chybí 'profile:', vypiš je
    if missing_profile_files:
        print("Soubory, kde chybí parametr 'profile:':")
        for file in missing_profile_files:
            print(file)
    
    # Pokud je seznam chybějících profilů neprázdný, test selže
    assert len(missing_profile_files) == 0, f"These files are missing the profile parameter: {missing_profile_files}"